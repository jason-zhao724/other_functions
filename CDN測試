javascript:(asyncfunction(){constcdnBaseList=["https://dla.3yjt.com","https://dlcd.3yjt.com","https://dlray.3yjt.com","https://dljb.3yjt.com","https://game.3yjt.com","https://i1tq4bgq3xg.3yjt.com","https://dlcd.ecosysmail.com","https://dlaws.ecosysmail.com","https://dlg.ecosysmail.com","https://k25ryj8x.ecosysmail.com"];consttimeoutMs=8000;constconcurrency=12;constslowThreshold=800;constmaxUrls=5000;constcdnResUrl=(window.gameSetting&&window.gameSetting.cdnResUrl)||null;if(!cdnResUrl){console.error("âŒæ‰¾ä¸åˆ°gameSetting.cdnResUrlã€‚è«‹ç¢ºèªæ‚¨æ˜¯å¦åœ¨éŠæˆ²Frameå…§åŸ·è¡Œï¼Œæˆ–gameSettingæ˜¯å¦å·²è¼‰å…¥ã€‚");alert("âŒæ‰¾ä¸åˆ°gameSetting.cdnResUrl\nè«‹æŒ‰F12æŸ¥çœ‹Console");return}constcdnResPrefix=cdnResUrl.endsWith("/")?cdnResUrl:(cdnResUrl+"/");const resBasePath=new URL(cdnResPrefix).pathname;performance.setResourceTimingBufferSize(10000);const entries=performance.getEntriesByType("resource");const matched=[];const seen=new Set;for(const e of entries){const u=e.name;if(!u||!u.startsWith(cdnResPrefix))continue;if(seen.has(u))continue;seen.add(u);matched.push(u);if(matched.length>=maxUrls)break}const relPaths=matched.map(u=>u.slice(cdnResPrefix.length));console.clear();console.group("ğŸ“¦ æœ¬æ¬¡è¼‰å…¥çš„ cdnResUrl è³‡æºæ¸…å–®");console.log("cdnResUrl =",cdnResPrefix);console.log("ç¸½æ•¸ =",relPaths.length);console.groupEnd();if(relPaths.length===0){console.warn("æ²’æœ‰æŠ“åˆ°ä»»ä½• cdnResUrl ä¸‹çš„è³‡æºã€‚");alert("âš ï¸ æ²’æœ‰æŠ“åˆ°ç›¸é—œè³‡æºï¼Œè«‹å…ˆè®“éŠæˆ²è·‘ä¸€æ®µæ™‚é–“å¾Œå†é»æ“Šæ¸¬è©¦ã€‚");return}console.log("ğŸš€ æ¸¬è©¦é–‹å§‹ï¼Œè«‹ç¨å€™...");async function testUrl(url){const start=performance.now();const controller=new AbortController;const timer=setTimeout(()=>controller.abort(),timeoutMs);const done=(ok,extra={})=>{const time=Math.round(performance.now()-start);clearTimeout(timer);return{ok:ok,time:time,...extra,result:ok?(time>slowThreshold?"âš ï¸ SLOW":"âœ… OK"):"âŒ ERROR"}};try{const r=await fetch(url,{method:"HEAD",cache:"no-store",mode:"cors",signal:controller.signal});return done(r.ok,{status:r.status,mode:"HEAD(cors)"})}catch(e1){try{const r=await fetch(url,{method:"GET",cache:"no-store",mode:"cors",signal:controller.signal});return done(r.ok,{status:r.status,mode:"GET(cors)"})}catch(e2){if(/\.(png|jpg|jpeg|webp|gif|bmp)(\?|$)/i.test(url)){try{const imgOk=await new Promise(resolve=>{const img=new Image;const t=setTimeout(()=>resolve(false),timeoutMs);img.onload=()=>{clearTimeout(t);resolve(true)};img.onerror=()=>{clearTimeout(t);resolve(false)};img.src=url+(url.includes("?")?"&":"?")+"cdnProbe="+Date.now()});return done(imgOk,{status:imgOk?"LOAD":"ERROR",mode:"IMG"})}catch(e3){return done(false,{status:"FAILED",mode:"IMG",error:String(e3)})}}return done(false,{status:"FAILED",mode:"FETCH",error:String(e2)})}}}function makeTestUrl(base,rel){return base.replace(/\/+$/,"")+resBasePath+rel}const jobs=[];for(const base of cdnBaseList){for(const rel of relPaths){jobs.push({base:base,rel:rel,url:makeTestUrl(base,rel)})}}console.log(`ğŸ§ª é–‹å§‹æ¸¬è©¦ï¼šCDN=${cdnBaseList.length}ï¼Œè³‡æº=${relPaths.length}ï¼Œç¸½è«‹æ±‚=${jobs.length}`);const results=[];let idx=0;async function worker(){while(idx<jobs.length){const my=jobs[idx++];const r=await testUrl(my.url);results.push({CDN:my.base,RelPath:my.rel,Status:r.status,Time_ms:r.time,Mode:r.mode,Result:r.result,URL:my.url})}}await Promise.all(Array.from({length:concurrency},()=>worker()));const byCdn={};for(const r of results){const k=r.CDN;(byCdn[k]||={total:0,ok:0,slow:0,fail:0}).total++;if(r.Result==="âœ… OK")byCdn[k].ok++;else if(r.Result==="âš ï¸ SLOW")byCdn[k].slow++;else byCdn[k].fail++}const summary=Object.entries(byCdn).map(([cdn,s])=>({CDN:cdn,Total:s.total,OK:s.ok,SLOW:s.slow,FAIL:s.fail,SuccessRate:((s.ok+s.slow)/s.total*100).toFixed(1)+"%"})).sort((a,b)=>(b.OK+b.SLOW)-(a.OK+a.SLOW));const fails=results.filter(r=>r.Result.startsWith("âŒ"));console.group("ğŸ“¡ CDN æ‰¹æ¬¡é©—æ¸¬çµæœ");console.table(summary);console.log("âŒ FAIL æ˜ç´°ï¼š");console.table(fails.slice(0,200));console.log("resultsï¼ˆå®Œæ•´æ˜ç´°ï¼‰=",results);console.groupEnd();window.__cdnProbe={cdnResUrl:cdnResPrefix,relPaths:relPaths,results:results,summary:summary,fails:fails};console.log("âœ… å·²ä¿å­˜åˆ° window.__cdnProbe");alert(`âœ… æ¸¬è©¦å®Œæˆï¼\n\næœ€ä½³ CDN: ${summary[0]?summary[0].CDN:"ç„¡"}\næˆåŠŸç‡: ${summary[0]?summary[0].SuccessRate:"0%"}\n\nè©³ç´°å ±è¡¨è«‹æŒ‰ F12 æŸ¥çœ‹ Console`);})();
